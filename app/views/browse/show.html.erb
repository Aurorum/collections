<% add_view_stylesheet("browse") %>

<% content_for :title, page.title %>

<%= render 'shared/tag_meta', tag: page %>

<% content_for :meta_tags do %>
  <%= render "govuk_publishing_components/components/meta_tags", {
    content_item: {
      navigation_page_type: "Browse level 1",
      navigation_list_type: page.second_level_pages_curated? ? "curated" : "default",
      section: page.title.downcase,
    }
  } %>
<% end %>

<% content_for :breadcrumbs do %>
  <%= render "shared/browse_breadcrumbs", {
    column_two_thirds: true
  } %>
<% end %>

<%= render "shared/browse_header", { margin_bottom: [ "benefits", "business" ].include?(page.slug) ? 7 : 9 } do %>
  <h1 class="browse__heading govuk-heading-xl">
    <%= page.title %>
  </h1>
  <%= render "govuk_publishing_components/components/lead_paragraph", {
    text: page.description,
    margin_bottom: 2,
    inverse: true
  } %>
<% end %>

<% if [ "benefits", "business" ].include?(page.slug) %>
  <div class="govuk-width-container">
    <div class="govuk-grid-row">
      <% if page.slug == "benefits" %>
        <div class="govuk-grid-column-full">
          <%= render "shared/browse_action_link", locals: { text: t("browse.check_benefits_and_financial_support"), href: "/check-benefits-financial-support" } %>
        </div>
      <% elsif page.slug == "business" %>
        <div class="govuk-grid-column-one-third">
          <%= render "shared/browse_action_link", locals: { text: t("browse.file_your_self_assessment"), href: "/log-in-file-self-assessment-tax-return" } %>
        </div>
        <div class="govuk-grid-column-one-third">
          <%= render "shared/browse_action_link", locals: { text: t("browse.pay_your_self_assessment_tax_bill"), href: "/pay-self-assessment-tax-bill" } %>
        </div>
        <div class="govuk-grid-column-one-third">
          <%= render "shared/browse_action_link", locals: { text: t("browse.employing_people"), href: "/browse/employing-people" } %>
        </div>
      <% end%>
    </div>
  </div>
<% end %>

<% total_links = page.second_level_browse_pages.count.to_s %>
<%= render "shared/browse_cards_container" do %>
  <%= render "govuk_publishing_components/components/cards", {
    items: page.second_level_browse_pages.map.with_index do |second_level_browse_page, index|
      {
        link: {
          text: second_level_browse_page.title,
          path: second_level_browse_page.base_path,
          data_attributes: {
            track_category: "browseClicked",
            track_action: "topicsLink",
            track_label: second_level_browse_page.base_path,
            track_dimension: second_level_browse_page.title,
            track_options: {
              dimension28: total_links,
              dimension29: second_level_browse_page.title,
              dimension114: index + 1,
            },
            ga4_link: {
              event_name: "navigation",
              type: "browse card",
              index_link: index + 1,
              index_total: total_links,
            },
          },
        },
        description: second_level_browse_page.description,
      }
    end,
    sub_heading_level: 2,
  } %>
<% end %>
